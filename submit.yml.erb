<%-
  cores = num_cores.to_i

  if cores == 0
    base_slurm_args = ["--nodes", "1", "--exclusive"]
  else
    base_slurm_args = ["--nodes", "1", "--ntasks-per-node", "#{cores}"]
  end

  slurm_args = case node_type
              when "gpu"
                base_slurm_args + ["--gpus-per-node", "1"]
              when "debug"
                base_slurm_args += ["--partition", "debug", "--exclusive"]
              else
                base_slurm_args
              end

-%>
---
batch_connect:
  template: "basic"
  conn_params:
    - jupyter_api
script:
  native:
    <%- slurm_args.each do |arg| %>
    - "<%= arg %>"
    <%- end %>
